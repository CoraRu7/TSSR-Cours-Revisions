# Fiche de Révision – Paramétrage et utilisation d’un serveur Syslog

## Objectif

Savoir mettre en place un serveur Syslog pour centraliser les logs de différents systèmes (Linux, Windows, routeurs, switches) et les consulter depuis un poste administrateur.

---

## Concepts Clés

### 1. Syslog

* **Définition** : Protocole de journalisation du système (*System Logging Protocol*), centralise les logs des systèmes et applications.
* **Port par défaut** : 514 UDP (peut être configuré en TCP, port 1468 pour accusé de réception).
* **Fonctionnement** : Client/serveur : chaque client envoie des messages textuels au serveur qui les reçoit.
* **Localisation des logs sur Linux** :

  * Debian/Ubuntu : `/var/log/syslog`
  * RedHat/CentOS : `/var/log/message`
* **Exemple d’utilisation** : Logs des serveurs, connexions utilisateurs, événements matériels, erreurs applicatives.

### 2. Format d’un message Syslog

* Syntaxe générale :
  `[Date][Heure][NomHôte][Application][Priorité][Message]`
* **Éléments** : priorité, version, chronologie, nom de l’hôte, application, procédure et message.

### 3. Centralisation

* **But** : Voir tous les logs depuis un seul serveur.
* **Avantage** : Gain de temps dans la gestion des incidents, filtrage et analyse simplifiée.

---

## Mise en œuvre – Schéma VM

* Serveur Syslog : **SrvSyslog**
* Windows Server 2016 : **WinServ-AD**
* Linux Debian serveur : **SrvLamp**
* Poste administrateur : **Win10Admin**
* Objectif : Voir les logs de SrvLamp et WinServ-AD sur SrvSyslog depuis Win10Admin.

---

## Redirection des logs

### A. Sur Linux Debian (SrvLamp)

**Étape 1 : Connexion**

```bash
ssh root@SrvLamp
```

**Étape 2 : Éditer le fichier rsyslog**

```bash
nano /etc/rsyslog.conf
```

**Étape 3 : Ajouter la ligne suivante à la fin du fichier**

```bash
*.* @@192.168.100.200:514
```

* `*.*` : tous les logs
* `@@` : en TCP
* `192.168.100.200` : IP du serveur Syslog
* `:514` : port utilisé

**Étape 4 : Redémarrer le service rsyslog**

```bash
systemctl restart rsyslog.service
```

**Étape 5 : Redémarrer les services LAMP si nécessaire**
Vérifiez que les logs remontent vers SrvSyslog.

---

### B. Sur Windows Server 2016 (WinServ-AD)

**Étape 1 : Installer Rsyslog Agent**

* Télécharger depuis [Adiscon](https://www.rsyslog.com/)
* Exécuter l’installateur, cliquer sur **Next**, accepter la licence, choisir chemin d’installation, installation complète, puis **Install**.

**Étape 2 : Après redémarrage, configurer Rsyslog Agent**

* Ouvrir **Rsyslog Agent Configuration**
* Aller dans : `Default Rules / ForwardSyslog / Actions / Rsyslog`
* Dans **Syslog Server**, saisir l’adresse IP de **SrvSyslog**
* Cliquer sur **Save**
* Cliquer sur **Start** pour lancer l’agent et établir la communication

**Étape 3 : Vérification sur poste administrateur (Win10Admin)**

* Ouvrir navigateur web
* Saisir l’URL et identifiants du serveur Syslog
* Vérifier que **WinServ-AD** apparaît dans les logs remontés

**Remarque : problème de caractères**

* Si erreurs persistantes :
  Modifier `Outpoint Encoding` de « System Default » à « Unicode UTF8 »
  Redémarrer l’agent

---

## Lecture et filtrage des logs

* LogAnalyzer permet :

  * Voir logs triés par date, hôte, gravité et message
  * Filtrer par événement (Error, Warning, etc.)
  * Trier par hôte ou service pour cibler un problème

---

## Rappels importants

* Synchronisation de temps indispensable pour avoir des logs cohérents.
* Les logs peuvent saturer le serveur : prévoir purge régulière.
* Relation **client/serveur** : renseigner correctement les clients pour envoyer les logs au serveur Syslog.
* Syslog majoritairement disponible sur Linux (rsyslog), pas nativement sur Windows (nécessite Rsyslog Agent).

---

## Essentiel

* Mise en place d’un serveur Syslog centralisé : gain de temps et réactivité.
* Installation correcte et paramétrage précis = base d’un système fiable.
* Filtrage et analyse des logs = compréhension rapide des incidents.

---