# Fiche — **Mise en œuvre d’un protocole de routage**

Résumé opérationnel : notions clés, différences routage statique / dynamique, commandes à connaître, procédures pas-à-pas (statiques + RIP/OSPF/EIGRP), exemple complet EIGRP repris du cours, vérifications et dépannage.

---

## 1 — Objectifs

* Comprendre quand utiliser routage **statique** vs **dynamique**.
* Savoir **configurer**, **vérifier** et **dépanner** des routes sur des routeurs Cisco (Packet Tracer ou matériel réel).
* Pouvoir transposer les procédures à d’autres topologies.

---

## 2 — Notions essentielles (rappel rapide)

* **Routage** = décision faite à chaque routeur : quel *next-hop* et quelle *interface* pour envoyer un paquet.
* **Table de routage** contient : destination (network/prefix), masque, next-hop, interface, métrique et source (C/S/R/O/D/B...).
* **Longest prefix match** + **Administrative Distance (AD)** déterminent la route choisie.
* **Routage statique** = routes configurées manuellement (`ip route`). simple, sécurisé, mais non-adaptatif.
* **Routage dynamique** = protocoles (RIP, OSPF, EIGRP...) qui échangent des informations et maintiennent automatiquement la table. adapté aux topologies changeantes.

---

## 3 — Commandes de base (Cisco / hôtes)

**Cisco (CLI)**

```
enable
configure terminal      (ou conf t)
interface <int>         (ex : interface GigabitEthernet0/0)
 ip address A.B.C.D M.M.M.M
 no shutdown
 exit
ip route <network> <mask> <next-hop>      // ajouter route statique
no ip route <network> <mask> <next-hop>   // supprimer route statique
show ip route
show ip interface brief
show running-config
show ip protocols
show ip arp
ping <ip>
traceroute <ip>
copy running-config startup-config
write memory
```

**Hôtes (Windows / Linux)**

* Windows : `route print`, `netstat -r`, `ping`, `tracert <ip>`
* Linux : `ip route show`, `ip route add ... via ...`, `ping`, `traceroute <ip>`

---

## 4 — Procédure générale avant toute configuration

1. **Établir le plan d’adressage** (réseaux, masques, passerelles).
2. **Câbler/topologie** : vérifier connexions physiques ou liens logiques.
3. **Configurer adresses IP** sur interfaces routeurs + activer (`no shutdown`).
4. **Vérifier** : `show ip interface brief`.
5. **Ajouter routes** (statiques ou activer protocole dynamique).
6. **Tester** : `show ip route`, `ping`, `traceroute`.
7. **Sauvegarder** : `write` ou `copy running-config startup-config`.

---

## 5 — Routage statique — procédure pas-à-pas (template transposable)

Situation : routeur A doit atteindre réseau `R_dest` via next-hop `NH`.

1. Passer en mode privilégié puis config :

```
Router> enable
Router# configure terminal
Router(config)# ip route <network_dest> <mask> <next-hop-IP>
Router(config)# end
Router# write
```

Exemples :

```
// route vers 192.168.5.0/24 via 10.0.0.2
ip route 192.168.5.0 255.255.255.0 10.0.0.2

// route par défaut via 10.0.0.1
ip route 0.0.0.0 0.0.0.0 10.0.0.1
```

2. Vérifier :

```
show ip route
ping <ip_du_dest>
traceroute <ip_du_dest>
show running-config | include ip route
```

3. Supprimer une route :

```
configure terminal
no ip route <network> <mask> <next-hop>
end
write
```

**Conseil:** si next-hop n’est pas joignable, la route apparaîtra mais non-utile — testez `ping <next-hop>` et `show ip arp`.

---

## 6 — Routage dynamique — procédures (RIP / OSPF / EIGRP)

### A) RIP (RIPv2) — configuration minimale

**Quand l’utiliser :** petits réseaux simples (limite 15 sauts).
**Configuration CLI :**

```
Router> enable
Router# configure terminal
Router(config)# router rip
Router(config-router)# version 2
Router(config-router)# network 192.168.1.0
Router(config-router)# network 10.0.0.0
Router(config-router)# end
Router# write
```

**Vérif / debug :**

```
show ip route        // routes marquées R
show running-config  // vérifier networks sous router rip
debug ip rip         // (facultatif, verbose)
```

### B) OSPF — configuration de base (area 0)

**Quand l’utiliser :** réseaux moyens à grands, multi-zones.
**Configuration CLI :**

```
Router> enable
Router# configure terminal
Router(config)# router ospf 1
Router(config-router)# network 192.168.1.0 0.0.0.255 area 0
Router(config-router)# network 10.0.0.0 0.0.0.3 area 0
Router(config-router)# end
Router# write
```

**Vérif :**

```
show ip ospf neighbor
show ip route         // routes marquées O
show ip ospf
```

**Remarques :**

* Utiliser wildcard mask (inverse du masque).
* S’assurer que tous les interfaces de voisinage sont dans la même `area` si on veut qu’ils deviennent voisins.

### C) EIGRP — configuration de base (Cisco)

**Quand l’utiliser :** environnements Cisco, convergence rapide, bonne scalabilité interne.
**Configuration CLI (exemple du cours)**
Sur chaque routeur, activer EIGRP et annoncer les réseaux connectés (wildcards) :

```
Router> enable
Router# configure terminal
Router(config)# router eigrp 1
Router(config-router)# network 192.168.1.0 0.0.0.255
Router(config-router)# network 10.10.10.0 0.0.0.3
Router(config-router)# end
Router# write
```

**Vérif :**

```
show ip route eigrp
show ip eigrp topology
show ip protocols
```

**Remarques :** EIGRP utilise hello packets ; assurer AS (process number) identique sur voisins.

---

## 7 — Exemple complet (topologie EIGRP fournie dans le cours)

Topologie (résumé) : 3 routeurs R0,R1,R2 interconnectés et 3 PC ; plan d’adressage donné (cf. fiche). Voici **les commandes complètes** prêtes à coller pour chaque routeur (Packet Tracer).

### R0

```
enable
configure terminal
hostname R0

interface fa0/0
 ip address 192.168.1.1 255.255.255.0
 no shutdown
exit

interface fa0/1
 ip address 10.10.10.1 255.255.255.252
 no shutdown
exit

interface fa1/0
 ip address 10.10.10.9 255.255.255.252
 no shutdown
exit

router eigrp 1
 network 192.168.1.0 0.0.0.255
 network 10.10.10.0 0.0.0.3     // pour 10.10.10.0/30 (fa0/1)
 network 10.10.10.8 0.0.0.3     // pour 10.10.10.8/30 (fa1/0)
end
write
```

### R1

```
enable
configure terminal
hostname R1

interface fa1/0
 ip address 192.168.2.1 255.255.255.0
 no shutdown
exit

interface fa0/1
 ip address 10.10.10.5 255.255.255.252
 no shutdown
exit

interface fa0/0
 ip address 10.10.10.2 255.255.255.252
 no shutdown
exit

router eigrp 1
 network 192.168.2.0 0.0.0.255
 network 10.10.10.4 0.0.0.3     // lien vers R0/R1
 network 10.10.10.0 0.0.0.3     // lien vers R1/R2 (selon plan)
end
write
```

*(Adapter les `network` selon précisément les interfaces et sous-réseaux de ta topologie.)*

### R2

```
enable
configure terminal
hostname R2

interface fa0/1
 ip address 192.168.3.1 255.255.255.0
 no shutdown
exit

interface fa1/0
 ip address 10.10.10.10 255.255.255.252
 no shutdown
exit

interface fa0/0
 ip address 10.10.10.6 255.255.255.252
 no shutdown
exit

router eigrp 1
 network 192.168.3.0 0.0.0.255
 network 10.10.10.8 0.0.0.3
 network 10.10.10.4 0.0.0.3
end
write
```

**Vérifications après configuration :**

```
show ip route            // vérifier présence des réseaux 192.168.1.*, 2.*, 3.*
show ip route eigrp
show ip eigrp topology
ping <PC distant>        // ex : depuis R0 ping 192.168.3.2
```

---

## 8 — Tests & dépannage (checklist rapide)

1. `show ip interface brief` → interfaces `up/up` ? sinon `no shutdown`.
2. `show ip route` → la route vers le réseau cible existe-t-elle ? (S / R / O / D)
3. `ping <next-hop>` → next-hop reachable ?
4. `show ip arp` → l’ARP montre bien la MAC du next-hop ?
5. `show running-config` → erreurs dans `ip address` / `network` / masque ?
6. `traceroute` / `tracert` depuis source pour localiser saut bloquant.
7. Si protocole dynamique : `show ip protocols` / `show ip ospf neighbor` / `show ip eigrp neighbors`.
8. Vérifier ACLs / NAT / firewall qui pourraient bloquer ICMP ou le trafic.
9. Sauvegarder après corrections (`write` ou `copy running-config startup-config`).

---

## 9 — Bonnes pratiques & recommandations

* Documente ton plan d’adressage et la topologie avant toute modification.
* Sur des liens critiques, préfère routage dynamique (OSPF/EIGRP) pour résilience.
* Utilise des routes statiques pour des chemins simples, de sécurité ou comme routes de secours (floating static avec AD > AD des protocoles dynamiques). Exemple d’une *floating static* :

  ```
  ip route 192.168.2.0 255.255.255.0 10.0.0.2 250
  ```

  (AD = 250 pour n’être utilisée que si aucune route dynamique n’existe.)
* Toujours **sauvegarder** la configuration après tests : `write` / `copy running-config startup-config`.
* Sur équipements Cisco : privilégier EIGRP dans environnement Cisco pur ; OSPF si interopérabilité multi-vendeurs.

---

## 10 — Récapitulatif commandes essentielles (copier/coller)

```
enable
configure terminal
interface <int>
 ip address A.B.C.D M.M.M.M
 no shutdown
exit

// route statique
ip route <dest> <mask> <next-hop>
no ip route <dest> <mask> <next-hop>

// RIP
router rip
 version 2
 network <network>

// OSPF
router ospf 1
 network <network> <wildcard> area 0

// EIGRP
router eigrp 1
 network <network> <wildcard>

// vérifs
show ip route
show ip interface brief
show running-config
show ip protocols
show ip arp
show ip ospf neighbor
show ip eigrp topology
ping <ip>
traceroute <ip>

// sauvegarde
write
copy running-config startup-config
```

---
