# Fiche — **Présentation d’une table de routage**
---

## 1 — Objectif

Savoir **lire**, **interpréter** et **agir** sur une table de routage : comprendre d’où vient chaque entrée, quel prochain saut sera utilisé et pourquoi un paquet prend un chemin plutôt qu’un autre.

---

## 2 — Définitions essentielles

* **Table de routage** : base de données sur un routeur/hôte listant les réseaux connus, le prochain saut (next-hop) et l’interface à utiliser. Sert à décider **où envoyer** un paquet.
* **Route directement connectée (C)** : réseau dont l’interface est configurée et active. Créée automatiquement.
* **Route statique (S)** : ajoutée manuellement (`ip route ...`).
* **Route dynamique** : apprise via un protocole (RIP = R, OSPF = O, EIGRP = D, BGP = B, etc.).
* **Route locale / Link (L)** : adresse IP de l’interface (host route).
* **Route par défaut** : `0.0.0.0/0` — utilisée si aucune autre route ne correspond.
* **Prochain saut (next-hop)** : IP du routeur suivant pour atteindre la destination.
* **Interface sortante** : port via lequel envoyer le paquet.
* **Administrative Distance (AD)** : confiance d’une source de route (plus petit = plus fiable). Exemples usuels :

  * connected = 0
  * static = 1
  * EIGRP internal = 90
  * OSPF = 110
  * RIP = 120
  * (BGP externe, etc. — valeurs standards Cisco)
* **Longest prefix match** : le routeur choisit la route ayant le plus grand préfixe (le plus spécifique) qui correspond à l’adresse de destination.

---

## 3 — Commandes à connaître

### Sur un routeur Cisco (CLI)

```text
show ip route                // afficher la table de routage IPv4
show ip route <network>      // info sur une route précise
show ip interface brief      // état & IP des interfaces
show running-config          // config en cours (voir routes statiques, protocols)
show ip protocols            // infos sur les protocoles de routage
show ip arp                  // cache ARP (liaison IP → MAC)
ip route <dest> <mask> <next-hop>   // ajouter une route statique
no ip route <dest> <mask> <next-hop>// supprimer une route statique
copy running-config startup-config  // sauvegarder
write memory                         // sauvegarder (synonyme)
ping <ip>                    // tester reachability
traceroute <ip>              // tracer le chemin
```

### Sur un poste / serveur

* **Windows**

```text
route print
ping <ip>
tracert <ip>
```

* **Linux / macOS**

```bash
ip route show
ip route add <network>/<mask> via <gateway>
ip route del <network>/<mask>
ping <ip>
traceroute <ip>
```

---

## 4 — Exemple de sortie `show ip route` (lecture expliquée)

Exemple de ligne :

```
S    192.168.2.0/24 [1/0] via 10.0.0.2, 00:00:12, GigabitEthernet0/1
```

* `S` : route **S**tatique
* `192.168.2.0/24` : réseau de destination
* `[1/0]` : `[AD / métrique]` → AD = 1 (statique), métrique = 0
* `via 10.0.0.2` : **next-hop** (passerelle)
* `00:00:12` : temps écoulé (si dynamique) — ici montre âge
* `GigabitEthernet0/1` : interface sortante

Autre exemples de codes courants :

* `C` → Connected (directement connecté)
* `L` → Local (adresse IP de l’interface)
* `R` → RIP
* `O` → OSPF
* `D` → EIGRP
* `B` → BGP

---

## 5 — Procédure pas-à-pas : lire une table de routage Cisco et diagnostiquer

### 1) Afficher la table

```text
show ip route
```

Regarder :

* y a-t-il une **route pour le réseau de destination** ? (recherche / longest prefix)
* si plusieurs entrées, comparer l’**AD** (priorité) et choisir la plus fiable.

### 2) Si la route attendue manque → vérifier interfaces

```text
show ip interface brief
```

* état `up/up` ? si `administratively down` → `interface <int>` → `no shutdown`.

### 3) Vérifier ARP / connectivité du next-hop

```text
show ip arp
ping <next-hop-ip>
```

### 4) Vérifier la configuration statique (si route manquante ou erronée)

```text
show running-config | include ip route
// ou
show running-config
```

Créer/rectifier une route statique :

```text
configure terminal
ip route 192.168.2.0 255.255.255.0 10.0.0.2
end
write memory
```

### 5) Tester bout-à-bout

* ping depuis le routeur : `ping 192.168.2.10`
* ping depuis un PC du réseau source vers une IP du réseau destination
* si échec : `traceroute` pour localiser l’étape où ça bloque.

---

## 6 — Règles de sélection d’une route (ordre résumé)

1. **Matching route la plus spécifique** (longest prefix)
2. Si égalité de spécificité : **Administrative Distance** la plus faible.
3. Si même AD : métrique/protocole (selon protocole) / égal-cost multipath possible.

---

## 7 — Types d’entrées et comportements pratiques

* **Connected (C)** : toujours présent si interface up. Si absent → interface IP incorrecte / down.
* **Static (S)** : persiste jusqu’à suppression. Peut définir un `next-hop` IP ou une interface.
* **Dynamic (R/O/D/...)** : mises à jour automatiques ; si voisin down, la route disparaît automatiquement.
* **Route par défaut** : `ip route 0.0.0.0 0.0.0.0 <next-hop>` → utilisée en dernier recours.

---

## 8 — Cas réels & commandes utiles pour diagnostiquer des problèmes fréquents

### Problème : « pas de route vers X »

* vérifier présence dans `show ip route`
* si statique manquante → `show running-config` puis `ip route ...`
* vérifier `show ip interface brief` → `no shutdown` si nécessaire
* tester `ping <next-hop>` ; si NOK → vérifier câblage ou interfaces intermédiaires
* utiliser `traceroute` pour repérer le saut qui échoue

### Problème : route apprise mais pas utilisée

* vérifier AD et si une route plus spécifique existe (`show ip route <prefix>`)
* vérifier ACLs qui bloqueraient le trafic (sur interfaces)
* vérifier NAT/firewall sur le chemin

---

## 9 — Exemples pratiques rapides

### 1. Ajouter une route statique sur un routeur Cisco

```text
Router> enable
Router# configure terminal
Router(config)# ip route 192.168.50.0 255.255.255.0 10.0.0.2
Router(config)# end
Router# write memory
```

### 2. Supprimer une route statique

```text
Router(config)# no ip route 192.168.50.0 255.255.255.0 10.0.0.2
```

### 3. Vérifier la route précise et son utilisation

```text
show ip route 192.168.50.0
show ip route
show ip interface brief
show ip arp
ping 10.0.0.2
traceroute 192.168.50.10
```

### 4. Sur un PC Windows — afficher table de routage

```text
C:\> route print
C:\> ping 192.168.50.10
C:\> tracert 192.168.50.10
```

### 5. Sur Linux — afficher et ajouter (temporaire) route

```bash
ip route show
sudo ip route add 192.168.50.0/24 via 10.0.0.2
sudo ip route del 192.168.50.0/24
```

---

## 10 — Points importants à retenir (mémo)

* **Toujours** vérifier la table (`show ip route`) avant de modifier la topologie.
* Les routeurs utilisent **longest prefix** puis **AD** pour choisir l’itinéraire.
* Les routes **directement connectées** doivent être actives (`no shutdown`) pour exister.
* **Sauvegarder** vos modifications (`write memory` / `copy running-config startup-config`).
* Pour le diagnostic : `show ip route`, `show ip interface brief`, `show ip arp`, `ping`, `traceroute`.
* `route print` (Windows) et `ip route show` (Linux) permettent d’inspecter la table d’un hôte.

---