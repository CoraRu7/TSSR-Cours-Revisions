# **Fiche de révision : Gérer les utilisateurs, les droits et les partages sur Linux**
<details>
<summary>

## **Objectif**
</summary>

* Comprendre et maîtriser la gestion des utilisateurs, des groupes, des permissions et des partages de fichiers sous Linux.
* Assurer la sécurité des systèmes Linux et faciliter la collaboration entre utilisateurs.

---
</details>
<details>
<summary>

## **1. Gestion des utilisateurs**
</summary>

### **Définition**

* Un utilisateur Linux est une entité ayant un **UID** unique.
* Possède des droits spécifiques pour accéder aux fichiers et programmes.
* Essentiel pour la sécurité et l’organisation du système.

### **Création d’un utilisateur**

* Commandes principales :

```bash
sudo useradd -m nom_utilisateur   # Crée un utilisateur avec répertoire personnel
sudo passwd nom_utilisateur       # Définit le mot de passe
```

* Options supplémentaires :

  * `-s /bin/bash` : définir le shell
  * `-u UID` : définir un identifiant utilisateur spécifique

### **Changer d’utilisateur**

```bash
su nom_utilisateur    # Changer de session terminal
exit                  # Revenir à l’utilisateur initial
```

### **Suppression d’un utilisateur**

```bash
sudo userdel -r nom_utilisateur          # Supprime l'utilisateur et son home
sudo userdel --remove-all-files test    # Supprime l'utilisateur et tous ses fichiers
```

---
</details>
<details>
<summary>

## **2. Gestion des groupes et rôles**
</summary>

### **Rôles des groupes**

* Permettent de gérer les permissions collectives.
* Chaque groupe possède un **GID** unique.

### **Commandes clés**

```bash
sudo groupadd nom_du_groupe                  # Créer un groupe
sudo usermod -a -G nom_du_groupe utilisateur # Ajouter un utilisateur à un groupe
getent group nom_du_groupe                   # Lister les membres
```

### **Bonnes pratiques**

* Ajouter uniquement les utilisateurs nécessaires.
* Vérifier périodiquement l’appartenance aux groupes.
* Utiliser des groupes systèmes pour les services.

---
</details>
<details>
<summary>

## **3. Gestion des mots de passe et clés d’accès**
</summary>

### **Mots de passe**

* **Sécurité essentielle** : longueur suffisante, caractères variés, changements réguliers.

```bash
passwd utilisateur   # Changer mot de passe
```

* Politique de complexité et expiration via `/etc/login.defs`.

### **Clés SSH**

* Plus sécurisées que les mots de passe.

```bash
ssh-keygen                     # Créer une paire de clés
ssh-copy-id utilisateur@serveur # Déployer la clé publique
```

* Configurer `sshd_config` pour autoriser l’authentification par clé.

---
</details>
<details>
<summary>

## **4. Gestion des droits d’accès**
</summary>

### **Permissions Linux**

* Trois types : lecture (r), écriture (w), exécution (x)
* Trois catégories : propriétaire, groupe, autres

#### **Notation symbolique**

* Exemple : `rw-r-----`

  * Propriétaire : lecture et écriture
  * Groupe : lecture seule
  * Autres : aucun droit

#### **Notation numérique**

* r = 4, w = 2, x = 1
* Exemple : `640` = rw- r-- ---

### **Modifier permissions et propriétaires**

```bash
chmod 755 fichier           # Modifier permissions
chown utilisateur fichier  # Changer propriétaire
chgrp groupe fichier        # Changer groupe
```

### **Permissions spéciales**

* **setuid** : exécute avec droits du propriétaire
* **setgid** : fichiers héritent du groupe du répertoire
* **sticky bit** : seuls les propriétaires peuvent supprimer leurs fichiers dans un répertoire partagé

---
</details>
<details>
<summary>

## **5. Gestion des partages de fichiers**
</summary>

### **Partages NFS**

* Installation serveur : `sudo apt install nfs-kernel-server`
* Configurer `/etc/exports` :

```text
/srv/nfs/shared 192.168.1.0/24(rw,sync,no_subtree_check)
```

* Redémarrage et export :

```bash
sudo systemctl restart nfs-kernel-server
sudo exportfs -a
```

* Monter le partage côté client :

```bash
sudo mount -t nfs server_ip:/srv/nfs/shared /mnt/nfs
```

### **Partages SMB (Samba)**

* Installer : `sudo apt install samba samba-common-bin`
* Configurer `/etc/samba/smb.conf` :

```text
[MonPartage]
path = /srv/samba/share
writable = yes
browsable = yes
validusers = alice,bob
```

* Redémarrage : `sudo systemctl restart smbd`
* Journalisation des accès :

```text
log file = /var/log/samba/log.%m
max log size = 1000
```

---
</details>
<details>
<summary>

## **6. Gestion avancée des droits (ACL)**
</summary>

* ACL permettent d’attribuer des droits précis à des utilisateurs ou groupes :

```bash
setfacl -m u:john.doe:rwx /chemin/fichier
setfacl -m g:rd_team:rx /chemin/repertoire
getfacl /chemin/fichier_ou_repertoire  # Vérifier ACL
```

---
</details>
<details>
<summary>

## **Essentiel**
</summary>

* Comprendre UID/GID, permissions et groupes est la base pour sécuriser Linux.
* Utiliser `chmod`, `chown`, `chgrp`, et ACL pour gérer efficacement les droits.
* Configurer NFS et SMB pour le partage sécurisé de fichiers.
* Appliquer setuid, setgid, sticky bit avec prudence pour éviter les failles de sécurité.
* Journaliser les accès pour surveiller et auditer l’utilisation des ressources.

---
</details>