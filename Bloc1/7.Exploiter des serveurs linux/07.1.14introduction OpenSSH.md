# üßæ **Fiche de cours ‚Äì Introduction √† OpenSSH et protocole SSH**

<details>
<summary>

## üéØ **Objectif**
</summary>

Comprendre le fonctionnement du protocole **SSH (Secure Shell)**, ses diff√©rences avec **Telnet**, son r√¥le dans la **s√©curisation des connexions √† distance**, et l‚Äôusage de la suite **OpenSSH** pour l‚Äôadministration, le transfert de fichiers et la communication s√©curis√©e entre serveurs.

---
</details>
<details>
<summary>

## üß† **Concepts cl√©s**
</summary>

| Terme                                 | D√©finition                                                                                                                                          |
| ------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| **SSH (Secure Shell)**                | Protocole r√©seau s√©curis√© permettant l‚Äôacc√®s √† distance, l‚Äôex√©cution de commandes et le transfert de fichiers entre machines via un tunnel chiffr√©. |
| **OpenSSH**                           | Impl√©mentation libre et open source du protocole SSH, d√©velopp√©e par le projet OpenBSD.                                                             |
| **SFTP (SSH File Transfer Protocol)** | Protocole de transfert de fichiers s√©curis√©, bas√© sur SSH (successeur de FTP).                                                                      |
| **Telnet**                            | Ancien protocole d‚Äôacc√®s distant non chiffr√©, remplac√© par SSH.                                                                                     |
| **Cl√©s publique/priv√©e**              | Paire de cl√©s utilis√©e pour l‚Äôauthentification et le chiffrement asym√©trique.                                                                       |
| **Tunnel SSH**                        | Canal s√©curis√© chiffr√© entre le client et le serveur.                                                                                               |
| **OpenSSL**                           | Suite logicielle de chiffrement utilis√©e notamment par OpenSSH via la biblioth√®que **libcrypto**.                                                   |

---
</details>
<details>
<summary>

## üîç **1. Historique et contexte**
</summary>

* **Telnet** (ann√©es 70) permettait l‚Äôadministration distante, mais sans chiffrement ‚Üí toutes les donn√©es (login/mot de passe) transitaient **en clair**.
* **SSH** a √©t√© con√ßu pour remplacer Telnet et **s√©curiser les connexions** en chiffrant les √©changes.
* Cr√©√© par **Tatu Ylonen**, puis scind√© en deux versions :

  * **Tectia SSH** ‚Üí version commerciale.
  * **OpenSSH** ‚Üí version libre, maintenue par la communaut√© OpenBSD depuis **1999**.
* Int√©gr√© aujourd‚Äôhui dans la plupart des syst√®mes Linux et **nativement inclus dans Windows depuis 2018**.

---
</details>
<details>
<summary>

## ‚öôÔ∏è **2. Fonctionnement du protocole SSH**
</summary>

SSH repose sur **3 √©tapes principales** :

### üîπ Phase 1 ‚Äî N√©gociation et cr√©ation du tunnel s√©curis√©

* √âtablissement de la connexion TCP (port 22).
* Accord sur les **algorithmes de chiffrement** (AES, Blowfish, 3DES, etc.).
* Mise en place d‚Äôun **tunnel chiffr√©** via chiffrement **sym√©trique**.
* Int√©grit√© garantie par un **hachage** (MD5, SHA1, etc.).

### üîπ Phase 2 ‚Äî Authentification du client

* M√©thodes possibles :

  * **Login/mot de passe**
  * **Cl√©s SSH** (publique/priv√©e)
* Authentification asym√©trique : le serveur chiffre un message avec la cl√© publique du client, que seul ce dernier peut d√©chiffrer avec sa cl√© priv√©e.

### üîπ Phase 3 ‚Äî Connexion et transfert

* Ouverture de plusieurs **canaux ind√©pendants** (session, transfert, forwarding).
* Communication **chiffr√©e de bout en bout** entre le client et le serveur.
* SSH d√©connecte imm√©diatement si une alt√©ration des donn√©es est d√©tect√©e.

---
</details>
<details>
<summary>

## üîê **3. M√©thodes de chiffrement utilis√©es**
</summary>

| Type            | Principe                                                | Usage dans SSH                                       |
| --------------- | ------------------------------------------------------- | ---------------------------------------------------- |
| **Sym√©trique**  | M√™me cl√© pour chiffrer et d√©chiffrer (ex : AES, 3DES).  | Chiffrement de la session une fois le tunnel √©tabli. |
| **Asym√©trique** | Cl√© publique ‚Üî cl√© priv√©e (RSA, DSA, Diffie-Hellman).   | Authentification et √©change initial des cl√©s.        |
| **Hachage**     | Transformation non r√©versible d‚Äôun message (SHA1, MD5). | V√©rification d‚Äôint√©grit√© des donn√©es.                |

---
</details>
<details>
<summary>

## üß± **4. √âvolution du protocole SSH**
</summary>

| Version   | Am√©liorations                                                                        | Algorithmes utilis√©s                       |
| --------- | ------------------------------------------------------------------------------------ | ------------------------------------------ |
| **SSH-1** | Premi√®re version publique ‚Äî s√©curise Telnet, mais comporte des failles (RSA, CRC32). | DES, 3DES, Blowfish                        |
| **SSH-2** | Version actuelle ‚Äî plus s√ªre, supporte plusieurs flux, meilleure authentification.   | AES, CAST128, Arcfour, DSA, Diffie-Hellman |

üìå Aujourd‚Äôhui, **SSH-2** est la version standard sur tous les syst√®mes modernes.

---
</details>
<details>
<summary>

## üß© **5. Pr√©sentation de la suite OpenSSH**
</summary>

### üîπ R√¥le

OpenSSH fournit un ensemble d‚Äôoutils clients/serveurs pour administrer et s√©curiser les connexions √† distance.

### üîπ Principaux composants

| Outil                        | Fonction                                                                             | Paquet                |
| ---------------------------- | ------------------------------------------------------------------------------------ | --------------------- |
| **sshd**                     | Service principal (daemon) qui √©coute sur le port 22 et g√®re les connexions.         | openssh-server        |
| **ssh**                      | Client SSH pour se connecter √† un h√¥te distant et ex√©cuter des commandes.            | openssh-client        |
| **scp**                      | Copie de fichiers entre h√¥tes via SSH.                                               | openssh-client        |
| **sftp**                     | Transfert de fichiers s√©curis√© (successeur de FTP).                                  | openssh-client        |
| **ssh-keygen**               | G√©n√©ration et gestion de paires de cl√©s SSH.                                         | openssh-client/server |
| **ssh-copy-id**              | Copie la cl√© publique locale sur le serveur distant pour un acc√®s sans mot de passe. | openssh-client        |
| **ssh-agent / ssh-add**      | Gestion et stockage temporaire des cl√©s priv√©es.                                     | openssh-client        |
| **ssh-keyscan**              | Collecte les cl√©s publiques d‚Äôh√¥tes distants.                                        | openssh-client        |
| **ssh_config / sshd_config** | Fichiers de configuration client et serveur.                                         | inclus                |

---
</details>
<details>
<summary>

## üß† **6. Relations entre OpenSSH et OpenSSL**
</summary>

### üîπ Diff√©rences

| √âl√©ment                 | OpenSSH                                      | OpenSSL                                                      |
| ----------------------- | -------------------------------------------- | ------------------------------------------------------------ |
| Objectif                | Connexion et transfert s√©curis√©s (SSH/SFTP). | Chiffrement et s√©curisation de communications (HTTPS, VPN‚Ä¶). |
| Authentification client | Obligatoire.                                 | Non obligatoire.                                             |
| Usage typique           | Administration √† distance.                   | S√©curisation de sites web, √©changes TLS/SSL.                 |

### üîπ Similitudes

* Chiffrement des communications.
* Authentification des √©changes.
* Int√©grit√© et fiabilit√© des donn√©es.

### üîπ Interaction technique

OpenSSH s‚Äôappuie sur la biblioth√®que **libcrypto** d‚ÄôOpenSSL pour :

* Le chiffrement sym√©trique et asym√©trique.
* La g√©n√©ration de cl√©s et de signatures.
* Le calcul de hachages.

---
</details>
<details>
<summary>

## üíª **7. Commandes & manipulations essentielles**
</summary>

### üîπ Installation

```bash
sudo apt update && sudo apt install openssh-server -y
```

### üîπ V√©rification du service

```bash
sudo systemctl status ssh
sudo systemctl enable ssh
```

### üîπ Connexion √† un serveur distant

```bash
ssh utilisateur@adresse_IP
```

### üîπ Copie de fichier s√©curis√© (scp)

```bash
scp fichier.txt user@192.168.1.10:/home/user/
```

### üîπ Transfert via SFTP

```bash
sftp user@192.168.1.10
# puis : put fichier.txt  ou get fichier.txt
```

### üîπ G√©n√©ration de cl√© SSH

```bash
ssh-keygen -t rsa -b 4096 -C "ton_email@example.com"
```

### üîπ Copie de la cl√© publique sur le serveur

```bash
ssh-copy-id user@192.168.1.10
```

### üîπ Fichier de configuration du serveur

```bash
sudo nano /etc/ssh/sshd_config
```

Exemples de directives :

```ini
Port 22
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes
```

---
</details>
<details>
<summary>

## üß© **8. S√©curit√© et bonnes pratiques**
</summary>

| Recommandation                                        | Description                                       |
| ----------------------------------------------------- | ------------------------------------------------- |
| üîí **D√©sactiver l‚Äôacc√®s root**                        | Dans `/etc/ssh/sshd_config`, `PermitRootLogin no` |
| üîë **Utiliser les cl√©s plut√¥t que les mots de passe** | Authentification plus robuste                     |
| üìÅ **Restreindre les permissions des cl√©s priv√©es**   | `chmod 600 ~/.ssh/id_rsa`                         |
| üß± **Changer le port par d√©faut (22)**                | √âvite les scans automatis√©s                       |
| üîç **Surveiller les logs SSH**                        | `/var/log/auth.log`                               |
| üß∞ **Utiliser Fail2ban**                              | Bloque les tentatives de brute-force              |

---
</details>
<details>
<summary>

## üß≠ **9. R√©sum√© visuel du fonctionnement SSH**
</summary>

```bash
[Client] -- Demande de connexion --> [Serveur SSHD]
       ‚Üï √âchange de cl√©s (Diffie-Hellman)
       ‚Üï Authentification (cl√© ou mot de passe)
       ‚Üï Tunnel chiffr√© sym√©trique
==> Commandes, transferts, sessions s√©curis√©es
```

---
</details>
<details>
<summary>

## üîó **Liens utiles**
</summary>

* Documentation officielle : [https://www.openssh.com/](https://www.openssh.com/)
* Wiki Debian : [https://wiki.debian.org/SSH](https://wiki.debian.org/SSH)
* Tutoriel OpenSSH Ubuntu : [https://help.ubuntu.com/community/SSH](https://help.ubuntu.com/community/SSH)
* OpenSSL project : [https://www.openssl.org/](https://www.openssl.org/)

---
</details>
<details>
<summary>

## ‚úÖ **√Ä retenir**
</summary>

* **SSH remplace Telnet** et assure la **s√©curit√© des connexions √† distance**.
* **OpenSSH** est l‚Äôimpl√©mentation libre la plus r√©pandue, disponible sur tous les OS modernes.
* Trois couches garantissent la s√©curit√© : **chiffrement sym√©trique**, **asym√©trique** et **hachage**.
* Les outils **ssh**, **scp**, **sftp** et **sshd** sont les piliers de l‚Äôadministration distante.
* Toujours **utiliser des cl√©s SSH**, **d√©sactiver root**, et **surveiller les logs** pour une s√©curit√© maximale.

---
</details>