<details>
<summary>

# Fiche 1 : Introduction à la sauvegarde sous Linux
</summary>

## Objectif

Assurer la **continuité des opérations et la protection des données** grâce à des sauvegardes fiables, manuelles ou automatisées.

## Concepts clés

* **Sauvegarde** : copie de données pour prévenir la perte en cas de panne ou incident.
* **Localisation des sauvegardes** : idéalement sur un serveur distant ou cloud, **jamais sur le serveur source uniquement**.
* **Types de sauvegarde** :

  * **Complète** : copie intégrale des fichiers et dossiers.
  * **Incrémentale** : ne copie que les fichiers modifiés ou ajoutés depuis la dernière sauvegarde.
  * **Différentielle** : copie les fichiers modifiés depuis la dernière sauvegarde complète.

---
</details>
<details>
<summary>

# Fiche 2 : Rsync – définition et fonctionnement
</summary>

## Définition

* **Rsync (Remote Synchronization)** : logiciel libre de synchronisation de fichiers/dossiers.
* **Fonction principale** : transférer des fichiers d’une source vers une destination, en optimisant le transfert par **comparaison des fichiers** (copie uniquement les changements).

## Pourquoi utiliser Rsync

* Optimisation des performances (pas de duplication inutile).
* Possibilité de sauvegarde **locale ou distante**.
* Possibilité de sécurisation via SSH.
* Automatisation possible via Cron.

## Concepts clés Rsync

* **Source** : dossier/fichier à sauvegarder.
* **Destination** : emplacement où les données sont copiées (local ou serveur distant).
* **Options principales** :

  * `-a` : archive (préserve permissions, dates, structure, liens symboliques).
  * `-v` : verbose (affiche les détails du transfert).
  * `-z` : compression pour réduire la taille du transfert.
  * `-e ssh` : sécurisation du transfert via SSH.

---
</details>
<details>
<summary>

# Fiche 3 : Commandes Rsync – exemples
</summary>

### 1. Sauvegarde locale (même serveur)

```bash
rsync -av /home/Directeur/Travail /tmp/Travail
```

* **Explication** : copie le dossier `Travail` vers `/tmp/Travail` en préservant les attributs et la structure.

### 2. Sauvegarde vers un serveur distant (non sécurisé)

```bash
rsync /home/Directeur/Travail user@ipServ2:/home/Sauvegarde/Travail
```

* **Explication** : transfert sur un serveur distant, **non sécurisé** sans SSH.

### 3. Sauvegarde vers un serveur distant avec SSH

```bash
rsync -e ssh -avz /home/Directeur/Travail user@ipServ2:/home/Sauvegarde/Travail
```

* **Explication** :

  * `-e ssh` : sécurise la connexion.
  * `-a` : archive.
  * `-v` : verbose.
  * `-z` : compression.

### 4. Sauvegarde incrémentale

* Rsync détecte automatiquement les fichiers **modifiés ou ajoutés** et ne copie que ceux-ci, réduisant temps et bande passante.

---
</details>
<details>
<summary>

# Fiche 4 : Mise en pratique sur Linux Debian 11
</summary>

## Étapes sur serveur source (DebServ1)

1. **Installation Rsync**

```bash
apt-get update && apt-get upgrade -y
apt-get install rsync -y
rsync --version
```

2. **Création du dossier de test**

```bash
mkdir /home/Travail
echo "Ceci est un fichier de test" > /home/Travail/Test
```

3. **Test de sauvegarde locale**

```bash
rsync -av /home/Travail/ /tmp/Travail/
ls /tmp/Travail
```

* Vérifie que la structure et les fichiers sont correctement copiés.

4. **Test de sauvegarde distante avec SSH**

```bash
rsync -e ssh -avz /home/Travail user@192.168.100.20:/tmp/Travail/
ssh user@192.168.100.20
ls /tmp/Travail
```

* **But** : vérifier le transfert sécurisé et complet.

---
</details>
<details>
<summary>

# Fiche 5 : Automatisation avec Cron
</summary>

## Définition

* **Cron** : planificateur de tâches sous Linux pour exécuter des commandes à intervalle régulier.

## Fonctionnement

* Planification basée sur : minutes, heures, jours du mois, mois, jours de la semaine.
* Commandes stockées dans le fichier **crontab** de l’utilisateur.

## Étapes pour automatiser Rsync

1. **Vérifier que le service Cron est actif**

```bash
systemctl status cron
systemctl start cron     # si inactif
systemctl enable cron    # activation au démarrage
```

2. **Éditer la crontab**

```bash
crontab -e
```

* Choisir un éditeur (Nano si novice).

3. **Ajouter une tâche (exemple toutes les 5 minutes)**

```bash
*/5 * * * * rsync -e ssh -avz /home/Travail user@192.168.100.20:/tmp/Travail/
```

4. **Redémarrer Cron**

```bash
systemctl restart cron
systemctl status cron
```

5. **Suivi des exécutions**

```bash
tail -f /var/log/cron.log
```

---

# Fiche 6 : SSH sans mot de passe pour Cron

1. **Générer une clé SSH**

```bash
ssh-keygen -t rsa -b 4096
```

2. **Copier la clé publique sur le serveur distant**

```bash
ssh-copy-id user@192.168.1.121
```

3. **Tester la connexion sans mot de passe**

```bash
ssh user@192.168.1.121
```

* **But** : Cron ne peut pas entrer de mot de passe, la clé SSH permet l’automatisation complète.

---
</details>
<details>
<summary>

# Fiche 7 : Exercice pratique – Sauvegarde automatisée
</summary>

## Contexte

* Serveurs : DS-SERV1 (192.168.10.1), DS-SERV2 (192.168.10.2)
* Répertoire à sauvegarder : `/var/projets/` → `/backups/projets/`
* Objectif : sauvegarde **manuelle puis automatique**.

### 1. Sauvegarde manuelle

```bash
rsync -avz -e ssh /var/projets/ root@192.168.10.2:/backups/projets/
ls -l /backups/projets/
```

### 2. Sauvegarde automatique toutes les heures

```bash
crontab -e
# Ajouter la ligne :
0 * * * * rsync -avz -e ssh /var/projets/ root@192.168.10.2:/backups/projets/
systemctl restart cron
tail -f /var/log/cron.log
```

---
</details>
<details>
<summary>

# Fiche 8 : Points essentiels à retenir
</summary>

* Rsync permet une **sauvegarde efficace** grâce à l’incrémentation et la compression.
* Toujours **sécuriser les transferts distants** avec SSH.
* Cron permet l’**automatisation** des sauvegardes selon un planning précis.
* **Clé SSH** indispensable pour automatiser les sauvegardes sans intervention.
* Toujours sauvegarder sur un serveur **distant** pour limiter les risques de perte de données.

---
</details>