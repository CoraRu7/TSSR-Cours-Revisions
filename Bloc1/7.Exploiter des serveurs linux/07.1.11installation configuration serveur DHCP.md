# **Fiche de cours – Serveur DHCP Debian**
<details>
<summary>

## 1️⃣ **Contexte et intérêt du DHCP**
</summary>

* **DHCP (Dynamic Host Configuration Protocol)** : protocole réseau client-serveur qui attribue **automatiquement des adresses IP** et options réseau (DNS, passerelle…) aux clients.
* **Ports UDP utilisés** : 67 (serveur) et 68 (client).
* **Avantages** :

  * Simplifie l’adressage IP
  * Évite les conflits d’adresses IP
  * Utile en environnement domestique ou professionnel
  * Facilite le déploiement de VLAN et réseaux segmentés

### **Fonctionnement en 4 étapes**

1. **DHCP Discover** : le client cherche un serveur DHCP.
2. **DHCP Offer** : le serveur propose une adresse IP.
3. **DHCP Request** : le client accepte et demande confirmation.
4. **DHCP ACK** : le serveur confirme et attribue l’adresse IP.

---
</details>
<details>
<summary>

## 2️⃣ **Plan d’adressage IP**
</summary>

* **Avant DHCP** : construire un plan IP → étendue, masque, VLAN, DNS, passerelle.
* **Classes d’adresses IP privées** :

  * Classe A : 10.0.0.0 – 10.255.255.255
  * Classe B : 172.16.0.0 – 172.31.255.255
  * Classe C : 192.168.0.0 – 192.168.255.255
* **Masque commun** : /24 → 254 IP utilisables
* **VLSM** : adapter le masque à la taille réelle du réseau

  * Calcul des IP utilisables : `(2^n - 2)` avec `n = nombre de bits pour hôtes`
  * Exemple : /27 → 5 bits → 32-2 = 30 IP utilisables

---
</details>
<details>
<summary>

## 3️⃣ **Installation DHCP sous Debian**
</summary>

### **Package ISC-DHCP-SERVER**

* Fournit adresses IP + options réseau aux clients (Windows, Linux, Mac).
* Permet :

  * Réservation IP (fixe par adresse MAC)
  * Refus d’adresses aux clients inconnus (`deny unknown-clients`)
  * DHCP PXE pour déploiement réseau

### **Prérequis**

* Carte réseau configurée en **IP fixe** avant installation

### **Commandes**

```bash
# Mise à jour
apt-get update && apt-get upgrade -y

# Installer le serveur DHCP
apt install isc-dhcp-server -y

# Vérifier service
systemctl status isc-dhcp-server
```

---
</details>
<details>
<summary>

## 4️⃣ **Configuration réseau**
</summary>

* Fichier : `/etc/network/interfaces`
* Exemple carte fixe `enp0s3` :

```bash
auto enp0s3
iface enp0s3 inet static
    address 192.168.56.10
    netmask 255.255.255.0
    gateway 192.168.56.1
    dns-nameservers 8.8.8.8
```

* Vérification : `ip a`

---
</details>
<details>
<summary>

## 5️⃣ **Configuration DHCP**
</summary>

### **Fichier principal :** `/etc/dhcp/dhcpd.conf`

* **Plage d’adresses (range)** : IP disponibles pour les clients
* **Option routers** : passerelle par défaut
* **Option subnet-mask** : masque réseau
* **Option domain-name-servers** : DNS
* **Réservations** : `host` → `hardware ethernet` → `fixed-address`
* **Durée du bail** : combien de temps le client garde l’IP
* **Options PXE** : IP pour démarrage réseau
* **Refuser clients inconnus** : `deny unknown-clients;`

### **Exemple d’étendue / réservation**

```bash
subnet 192.168.56.0 netmask 255.255.255.0 {
    range 192.168.56.25 192.168.56.35;
    option routers 192.168.56.1;
    option domain-name-servers 8.8.8.8;
}

host admin {
    hardware ethernet 08:00:27:D2:82:7B;
    fixed-address 192.168.56.30;
}
```

* Redémarrer le service après modification :

```bash
systemctl restart isc-dhcp-server.service
```

### **Vérification sur client Windows**

```cmd
ipconfig /release
ipconfig /renew
ipconfig /all
```

* Vérifier que l’IP correspond à la réservation et que le serveur DHCP est correct

---
</details>
<details>
<summary>

## 6️⃣ **Méthode pour réserver une IP**
</summary>

1. Sur client : `ipconfig /all` → récupérer MAC
2. Sur serveur : modifier `/etc/dhcp/dhcpd.conf`
3. Ajouter `host` avec MAC et `fixed-address`
4. Redémarrer service DHCP
5. Sur client : `ipconfig /renew` → vérifier l’adresse

---
</details>
<details>
<summary>

## 7️⃣ **Bonnes pratiques**
</summary>

* Planifier le réseau avant DHCP
* Séparer VLAN pour postes, wifi invité…
* Réserver IP pour administrateurs ou services critiques
* Interdire clients inconnus si nécessaire
* Toujours tester avec `ipconfig /renew` ou `dhclient`

---
</details>
<details>
<summary>

## ✅ **Résumé rapide**
</summary>

* **DHCP** : attribue IP + options automatiquement
* **ISC-DHCP-SERVER** : package Debian pour DHCP
* **Fichiers importants** :

  * `/etc/network/interfaces` → IP fixe du serveur
  * `/etc/dhcp/dhcpd.conf` → configuration DHCP
* **Commandes clés** :

```bash
systemctl restart isc-dhcp-server.service
ip a
ipconfig /renew
```

* **Réservations IP** → indispensable pour postes critiques

---
</details>