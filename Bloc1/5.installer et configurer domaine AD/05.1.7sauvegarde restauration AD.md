# Sauvegarder et restaurer un annuaire Active Directory


## ğŸ¯ Objectif
Mettre en place une stratÃ©gie de **sauvegarde** et de **restauration** de lâ€™annuaire Active Directory sous **Windows Server 2019**, afin dâ€™assurer la continuitÃ© du service en cas de panne, suppression ou corruption dâ€™objets.

---
<details>
<summary>

## ğŸ§© Concepts clÃ©s
</summary>

- **Active Directory (AD)** : Service dâ€™annuaire centralisÃ© stockant les informations sur les objets du rÃ©seau (utilisateurs, ordinateurs, groupes, imprimantesâ€¦).
- **ContrÃ´leur de domaine (DC)** : Serveur hÃ©bergeant la base AD, assurant authentification et autorisation.
- **ForÃªt / Domaine** : Structure hiÃ©rarchique dâ€™objets ; le domaine dÃ©finit les frontiÃ¨res administratives et les stratÃ©gies de sÃ©curitÃ©.
- **Sauvegarde AD** : Copie de lâ€™Ã©tat du systÃ¨me et des donnÃ©es de lâ€™annuaire (System State).
- **Wbadmin** : Utilitaire en ligne de commande pour gÃ©rer les sauvegardes Windows Server.
- **Mode DSRM (Directory Services Restore Mode)** : Mode de dÃ©marrage spÃ©cial permettant la restauration de lâ€™annuaire.
- **RODC (Read-Only Domain Controller)** : ContrÃ´leur de domaine en lecture seule utilisÃ© dans des environnements distants.

---
</details>
<details>
<summary>

## âš™ï¸ ProcÃ©dures principales
</summary>

### ğŸ”¹ Installation du serveur de sauvegarde
1. Ouvrir **Gestionnaire de serveur** â†’ **GÃ©rer** â†’ **Ajouter des rÃ´les et fonctionnalitÃ©s**  
2. SÃ©lectionner **Installation basÃ©e sur un rÃ´le ou une fonctionnalitÃ©**  
3. Choisir le serveur concernÃ© â†’ **Suivant**  
4. Dans **FonctionnalitÃ©s**, cocher **Sauvegarde Windows Server** â†’ Installer  
5. VÃ©rifier lâ€™installation via **CMD** avec la commande :
```bash
   wbadmin
````

---

### ğŸ”¹ CrÃ©ation dâ€™une sauvegarde Active Directory

1. CrÃ©er un dossier local `C:\Sauvegarde`
2. Partager le dossier : clic droit â†’ *Accorder lâ€™accÃ¨s Ã * â†’ *Tout le monde* â†’ *Partager*
3. Mapper le dossier partagÃ© comme lecteur rÃ©seau (ex : `\\127.0.0.1\sauvegarde`)
4. Lancer la sauvegarde via CMD :

```bash
   wbadmin start backup -backuptarget:\\127.0.0.1\sauvegarde -include:C: -systemstate -vssFull
   ```
5. Confirmer le dÃ©marrage avec **O** (oui)

---

### ğŸ”¹ Suppression dâ€™un objet AD

1. Ouvrir **Gestionnaire de serveur** â†’ **Outils** â†’ **Utilisateurs et ordinateurs Active Directory**
2. SÃ©lectionner lâ€™objet â†’ clic droit â†’ **Supprimer**
3. Si lâ€™objet est protÃ©gÃ© :

   * Activer **Affichage â†’ FonctionnalitÃ©s avancÃ©es**
   * Ouvrir **PropriÃ©tÃ©s â†’ Onglet Objet**
   * DÃ©cocher **ProtÃ©ger contre les suppressions accidentelles**
4. Supprimer de nouveau lâ€™objet â†’ validation

---

### ğŸ”¹ Restauration dâ€™un objet AD

#### Ã‰tape 1 â€“ RedÃ©marrage en mode DSRM

* RedÃ©marrer le serveur â†’ appuyer sur **F8**
* Choisir **Mode de rÃ©paration des services dâ€™annuaire**
* Se connecter avec le compte **Administrateur local** (non domaine)

#### Ã‰tape 2 â€“ Identifier la sauvegarde

Dans PowerShell (admin) :

```bash
wbadmin get versions
```

â†’ affiche les sauvegardes disponibles et leurs dates.

#### Ã‰tape 3 â€“ Restaurer lâ€™Ã©tat du systÃ¨me

ExÃ©cuter :

```bash
wbadmin start systemstaterecovery -version:10/15/2021-16:52
```

â†’ valider **O** (oui) Ã  chaque confirmation.

Le serveur redÃ©marre et restaure les fichiers AD.

#### Ã‰tape 4 â€“ VÃ©rification

* Ouvrir **Utilisateurs et ordinateurs Active Directory**
* VÃ©rifier la rÃ©apparition de lâ€™objet supprimÃ© (ex : dossier â€œSMOGâ€)

---
</details>
<details>
<summary>

## ğŸ§  Points importants
</summary>

* Toujours tester la restauration sur un **environnement isolÃ©** avant production.
* Ne pas restaurer une sauvegarde trop ancienne â†’ risque dâ€™incohÃ©rence entre contrÃ´leurs.
* Automatiser la sauvegarde rÃ©guliÃ¨re via **tÃ¢ches planifiÃ©es**.
* Conserver les sauvegardes sur un **lecteur externe ou distant**.
* Le mode **DSRM** est indispensable pour la restauration complÃ¨te de lâ€™annuaire.

---
</details>
<details>
<summary>

## ğŸ§¾ Protocoles et notions associÃ©es
</summary>

| Ã‰lÃ©ment      | Description                                                                   |
| ------------ | ----------------------------------------------------------------------------- |
| **LDAP**     | Protocole utilisÃ© pour interroger et modifier lâ€™AD                            |
| **Kerberos** | Protocole dâ€™authentification principal dâ€™AD                                   |
| **DNS**      | RÃ©solution de noms indispensable au fonctionnement de lâ€™AD                    |
| **NTDS.dit** | Fichier principal de la base de donnÃ©es AD                                    |
| **SYSVOL**   | RÃ©pertoire partagÃ© contenant les stratÃ©gies de groupe et scripts de connexion |

---
</details>
<details>
<summary>

## ğŸ”— Liens utiles
</summary>

* ğŸ“º *VidÃ©o :* Introduction Ã  lâ€™Active Directory
* ğŸ“º *VidÃ©o :* ContrÃ´leur de domaine et restauration AD
* ğŸ“˜ *Documentation Microsoft :* [Sauvegarde et restauration AD DS](https://learn.microsoft.com/fr-fr/windows-server/identity/ad-ds/manage/ad-restore)

---
</details>