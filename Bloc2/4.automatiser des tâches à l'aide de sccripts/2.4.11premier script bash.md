# **Création du premier script Bash**

## **Objectif**

Apprendre à créer, exécuter et automatiser un script Bash, en comprenant les structures de base, les variables, les conditions, les boucles et les bonnes pratiques.

---

## **Concepts clés**

### **1. Shell Bash et Shell Scripting**

* **Shell** : interpréteur de commandes facilitant l’interaction entre l’utilisateur et le système.

  * Commandes saisies dans le terminal ou dans un fichier sont vérifiées et exécutées selon la syntaxe.
  * Exemples de Shell : `bash`, `sh`, `csh`, `zsh`, `ksh`.
* **Bash** : Bourne Again Shell, Shell par défaut sur la plupart des distributions Linux.

  * Afficher le shell courant : `echo $SHELL`
  * Lister tous les shells disponibles : `cat /etc/shells`
* **Script** : fichier contenant une suite de commandes pour automatiser des tâches.

---

### **2. Structure d’un script**

1. **Shebang** : ligne initiale qui indique l’interpréteur :

```bash
#!/bin/bash
```

2. **Commentaires** : début de ligne avec `#` pour expliquer le code.

```bash
# Ceci est un commentaire
```

3. **Droits d’exécution** : rendre le script exécutable

```bash
chmod +x nom_script.sh
```

4. **Exécution du script** :

```bash
./nom_script.sh
# ou
sh nom_script.sh
```

---

### **3. Automatisation avec cron**

* **crontab** : planificateur de tâches sous Linux.

  * `crontab -l` : liste les tâches planifiées
  * `crontab -r` : supprime toutes les tâches planifiées
  * `crontab -e` : éditer/modifier les tâches planifiées
* **Syntaxe d’une tâche cron** :

```
minutes heures jour_du_mois mois jour_de_la_semaine utilisateur commande > log
```

* Symboles :

  * `-` : plage de valeurs (1-10)
  * `,` : liste de valeurs (1,2,3)
  * `*` : toutes les valeurs
  * `/` : intervalle (`*/6` = toutes les 6 unités)
* Exemples :

```
00 23 * * * /root/scripts/sauvegarde.sh  # sauvegarde quotidienne 23h00
00 */4 * * * /root/scripts/synchronisation-ftp.sh  # toutes les 4h
```

---

### **4. Caractères spéciaux**

Certains caractères ont une signification particulière et doivent être échappés avec `\` :

```
? * & < > ‘ ’ ~ “ ” ^ { } [ ; \ # ! $ espace
```

---

### **5. Commandes composées**

* `;` : enchaîner des commandes
* `|` : pipe, la sortie de la première commande est entrée de la seconde
* `||` : exécuter la seconde commande si la première échoue
* `&&` : exécuter la seconde commande si la première réussit

---

### **6. Variables**

* Déclaration :

```bash
var="valeur avec espace"
```

* Appel :

```bash
echo $var
```

---

### **7. Conditions**

* **if / else / elif** :

```bash
if condition ; then
    actions
elif autre_condition ; then
    actions
else
    actions
fi
```

* **case** :

```bash
case valeur in
  cas1) action1 ;;
  cas2) action2 ;;
  *) action_defaut ;;
esac
```

---

### **8. Boucles**

* **for** :

```bash
for element in $liste ; do
    actions
done
```

* **while** :

```bash
while test ; do
    actions
done
```

* **until** : s’exécute jusqu’à ce que la condition soit vraie

```bash
until test ; do
    actions
done
```

---

### **9. Bonnes pratiques**

* Planifier et détailler les étapes avant de coder
* Définir des variables explicites
* Tester chaque commande individuellement
* Commenter abondamment le script
* Vérifier les messages d’erreur et corriger le script

---

### **10. Exemple de script de sauvegarde**

```bash
#!/bin/bash

# Définition de la date du jour
dayJ=$(date +%Y-%m-%d)

# Définition du chemin de sauvegarde
pathsave=/tmp/backup_$dayJ

# Création du dossier de sauvegarde
/bin/mkdir $pathsave

# Création d'une archive du fichier à sauvegarder
/bin/tar -czvf $pathsave/fichierasauvegarder_$dayJ.tar.gz /tmp/fichierasauvegarder
```

* Utilisation de variables, commentaires et commandes composées.
* Automatisable via cron pour exécution planifiée.

---

### **III) Essentiel**

* La ligne de commande permet l’exécution immédiate des commandes.
* Un script combine plusieurs commandes pour automatiser une tâche.
* Un script peut être simple (quelques lignes) ou complexe (variables, boucles, conditions).
* Toujours commenter et tester son script pour garantir fiabilité et maintenabilité.

---