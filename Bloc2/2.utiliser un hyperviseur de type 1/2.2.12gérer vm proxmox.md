# **Gérer des machines virtuelles et des hôtes avec Proxmox VE**

## **Objectif**

Maîtriser la création, la gestion et l’optimisation de machines virtuelles et de conteneurs sur Proxmox VE, ainsi que l’administration avancée des nœuds et clusters pour assurer haute disponibilité, répartition de charge et performance.

---

## **Concepts clés**

### **1. Virtualisation avec Proxmox**

* Proxmox VE = **Linux Containers (LXC)** + **Kernel-based Virtual Machine (KVM)**.
* Objectifs : **maximiser l’utilisation des ressources**, assurer **haute disponibilité**, simplifier **gestion serveur**.
* Interface web conviviale + outils avancés pour **surveillance et optimisation**.

---

### **2. Gestion des machines virtuelles (VM)**

#### a. Interface web

* Accessible sur le **port 8006**.
* Dashboard → vue d’ensemble : cluster, nœuds, VM, conteneurs, stockage.
* Gestion centralisée des ressources, backup, stockage et console.

#### b. Création de VM et conteneurs

* **VM** : système complet, isolation forte, overhead élevé.
* **LXC** : partage le noyau, plus léger, ressources optimisées.
* **Étapes pour VM** : upload ISO → créer VM → config OS, disque, CPU, RAM, réseau → start.
* **Étapes pour LXC** : télécharger template → créer conteneur → config hostname, root password, disque, CPU, RAM, réseau → start.

#### c. Clonage, templates et snapshots

| Fonction     | Description                | Utilité                                  |
| ------------ | -------------------------- | ---------------------------------------- |
| **Clone**    | Copie complète d’une VM    | Déploiement rapide, machine indépendante |
| **Template** | Modèle prêt à l’emploi     | Déploiement standardisé de VMs           |
| **Snapshot** | Image instantanée d’une VM | Sauvegarde/restauration ponctuelle       |

---

### **3. Gestion avancée des VM**

* **Ressources** : CPU, RAM, swap, quotas, pools.
* **Réseau** : interfaces physiques, bridges, VLAN, firewall intégré.
* **Stockage** : local, partagé (CEPH, NFS, iSCSI), ZFS, SAN/NAS.
* **Sauvegardes** : planifiées ou snapshots pour **reprise après sinistre**.

---

### **4. Gestion des hôtes et clusters**

#### a. Concepts

* **Nœud** : serveur physique autonome avec CPU, RAM, stockage, réseau.
* **Cluster** : ensemble de nœuds → gestion centralisée + haute disponibilité + évolutivité.

#### b. Création et gestion de cluster

* Datacenter → Cluster → Create cluster.
* Ajouter nœuds via Join Cluster avec info + root password.

#### c. Fonctionnalités avancées

* **Migration directe (live migration)** : déplacer VM en cours d’exécution vers un autre nœud sans interruption.
* **Haute disponibilité (HA)** : failover automatique, stockage partagé, réduction temps d’arrêt.
* **Répartition de charge (Load balancing)** : CPU, RAM, bande passante → optimiser performances et évolutivité.

---

### **5. Surveillance des performances**

#### a. Hôtes

* CPU, RAM, SWAP, stockage, réseau → identifier goulots d’étranglement.
* Outils : interface web, `pveperf`, Grafana, Zabbix.

#### b. Machines virtuelles

* Métriques : latence, état, consommation CPU/RAM, trafic réseau.
* Bonnes pratiques : seuils d’alerte, collecte périodique, documentation historique.

---

## **Commandes utiles**

```bash
# Vérifier les performances d'un hôte
pveperf

# Lancer une VM
qm start <VMID>

# Arrêter une VM
qm shutdown <VMID>

# Convertir une VM en template
qm shutdown <VMID>
qm template <VMID>

# Cloner une VM/template
qm clone <SourceID> <NewID> --full
```

---

## **Liens et outils complémentaires**

* [Documentation officielle Proxmox VE](https://pve.proxmox.com/wiki/Main_Page)
* Monitoring : Grafana, Zabbix, InfluxDB
* Stockage distribué : CEPH, NFS, iSCSI

---

### **Résumé**

* Proxmox VE : outil **polyvalent et open-source**, combinant VM et conteneurs.
* Clonage, templates, snapshots → simplifient déploiement et maintenance.
* Gestion avancée : **CPU, RAM, stockage, réseau, HA, load balancing**.
* Surveillance → optimisations performances et continuité de service.

---