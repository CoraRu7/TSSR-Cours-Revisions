# Fiche – Diagnostiquer et réparer un dysfonctionnement sous Hyper-V

## I) Problèmes de réseaux virtuels

### Contexte

* Hyper-V est une plateforme de virtualisation stable et fiable, mais des problèmes peuvent survenir.
* Objectif : aider les administrateurs à **diagnostiquer et résoudre les problèmes réseau Hyper-V**.

### Outil principal : Virtual Machine Manager (VMM)

* **Cmdlet PowerShell :** `Repair-SCVirtualNetwork`
* Permet de réparer un réseau virtuel défectueux.

### Problème fréquent

* Plusieurs hôtes Hyper-V peuvent avoir **des commutateurs virtuels portant le même nom**.
* System Center traite ces commutateurs comme **un seul réseau**, même s’ils sont sur des hôtes différents.

### Méthode de réparation

1. **Lister et sélectionner le réseau virtuel à réparer :**

```powershell
$VirtualNetwork = Get-SCVirtualNetwork -Name "Mon réseau virtuel" 
```

2. **Filtrer pour un hôte spécifique :**

```powershell
$VirtualNetwork = Get-SCVirtualNetwork -Name "Mon réseau virtuel" | Where-Object {filter}
```

3. **Vérifier le réseau sélectionné :**

```powershell
$VirtualNetwork | Select-Object Name, VMHost
```

4. **Réparer le réseau virtuel :**

```powershell
Repair-SCVirtualNetwork -VirtualNetwork $VirtualNetwork
```

> Astuce : mapper le réseau virtuel à une **variable** permet d’éviter les conflits lorsque plusieurs hôtes ont des réseaux identiques.

---

## II) Erreur “Hypervisor is not running”

### Symptômes

* Message d’erreur lors de l’exécution de plusieurs OS sous Hyper-V sur Windows 10.
* Hyper-V ne fonctionne pas.

### Solutions

1. **Activer la virtualisation dans le BIOS**.
2. **Vérifier la compatibilité CPU** pour la virtualisation.
3. **Vérifier le paramètre hypervisorlaunchtype :**

```cmd
bcdedit /set hypervisorlaunchtype auto
```

4. **Mettre à jour le BIOS** si l’hyperviseur ne démarre pas.
5. **Supprimer les mises à jour problématiques** qui empêchent Hyper-V de fonctionner.

---

## III) Essentiel

* Hyper-V reste stable et fiable, mais des problèmes peuvent apparaître, surtout au niveau des réseaux virtuels et de l’activation de l’hyperviseur.
* Pour les **réseaux virtuels**, utiliser `Repair-SCVirtualNetwork` avec un **filtrage précis pour un hôte spécifique**.
* Pour l’erreur Hypervisor : vérifier **BIOS, virtualisation activée, CPU compatible, paramètre hypervisorlaunchtype et mises à jour**.
