# Fiche – Création et gestion d’un cluster Hyper-V

## I) Contexte

* Les **clusters Hyper-V** assurent :

  * **Haute disponibilité** des applications et services critiques.
  * **Tolérance aux pannes** via le **Clustering de basculement** Windows Server.
* Hyper-V gère les machines virtuelles et les ressources physiques.
* Le **Clustering de basculement** assure le basculement et la haute disponibilité.
* Le **Gestionnaire du cluster de basculement** est l’outil principal pour configurer, gérer et surveiller le cluster.

---

## II) Pré-requis à la création d’un cluster

1. **Configuration des nœuds :**

   * Même domaine et unité d’organisation.
   * Adresse IP partagée dans le même sous-réseau.
   * Même version de Windows Server.
2. **Installation du rôle « Clustering de basculement »** sur chaque nœud.
3. **Stockage partagé préparé et accessible** par tous les nœuds.
4. **Privilèges utilisateur adéquats** pour créer un Computer Name Object (CNO) dans Active Directory.
5. **Validation du cluster** recommandée avant création (tests de compatibilité matériel/logiciel).

**Note pratique : Virtualisation imbriquée**

* Pour Hyper-V sur VM : activer virtualisation imbriquée (VMware ou VirtualBox).

  * VirtualBox : `VBoxManage modifyvm “nom de la vm” --nested-hw-virt on`
  * VMware : ajouter `vhv.enable = “TRUE”` dans le fichier .vmx

---

## III) Création d’un cluster Hyper-V (via Gestionnaire du cluster de basculement)

### Étapes principales :

1. **Installation des rôles de cluster de basculement** sur tous les nœuds.
2. **Validation de la configuration** via le Gestionnaire du cluster de basculement.
3. **Lancement de l’assistant de création de clusters** :

   * Saisir noms des nœuds.
   * Nommer le cluster et attribuer une IP.
   * Configurer le quorum (souvent automatique).
4. **Ajout du stockage éligible** au cluster (LUNs et disque de quorum).
5. **Construction et validation du cluster**.
6. **Connexion et gestion du cluster créé** via le Gestionnaire.

---

## IV) Gestion d’un cluster Hyper-V

### Sections principales du Gestionnaire :

1. **Nœuds :** ajouter, supprimer, mettre en ligne/hors ligne, pause/reprise.
2. **Stockage :** gérer volumes partagés, assigner à des nœuds, priorités de basculement.
3. **Réseaux :** configurer adresses IP et paramètres de basculement.
4. **Ressources :** gérer services et applications, ajouter/supprimer, définir priorités de basculement.
5. **Récapitulatif du cluster :** état global, santé, erreurs, configurations des ressources.

### Opérations supplémentaires :

* Configurer rôles (ex : VM hautement disponible).
* Valider le cluster et consulter les rapports de validation.
* Ajouter ou supprimer des nœuds.
* Réinitialiser événements récents.
* Arrêter ou supprimer le cluster.
* Déplacer ressources (quorum, CNO).
* Mise à jour automatisée via **Cluster-Aware Updating (CAU)**.
* Rafraîchir, configurer propriétés, consulter aide intégrée.

---

## V) Essentiel

* La **création et gestion d’un cluster Hyper-V** nécessite :

  * Respect des prérequis (nœuds, stockage, rôle clustering).
  * Validation préalable de la configuration.
  * Suivi des étapes guidées par l’assistant.
* La gestion efficace repose sur la maîtrise du Gestionnaire de cluster : navigation entre **nœuds, stockage, réseaux et ressources**, et utilisation des **assistants et options avancées**.

---