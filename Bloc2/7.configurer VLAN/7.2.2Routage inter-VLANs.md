# **Routage inter-VLANs**

## **I) Introduction et contexte**

### **Contexte**

* Les VLANs sont des **segments logiques** sur un réseau local commuté.
* **Routage inter-VLANs** = permettre la communication entre VLANs différents.
* Les VLANs agissent comme des **sous-réseaux distincts** : pour communiquer, il faut une **passerelle** par VLAN.

### **Méthodes principales**

1. **Router on a stick** → un seul port physique sur le routeur, subdivisé en **sous-interfaces** pour chaque VLAN.
2. **Interface dédiée (routage inter-VLANs traditionnel)** → plusieurs interfaces physiques, une par VLAN.
3. **Switch de niveau 3 / SVI (Switch Virtual Interface)** → routage matériel sur le switch, sans liaison physique supplémentaire.

---

## **II) Interface virtuelle de commutateur (SVI)**

* Interface **virtuelle**, non liée à un port physique spécifique.
* Sert à :

  * Administration à distance du switch
  * Routage inter-VLANs rapide (latence faible)
  * Supporte les paquets de tous les ports physiques associés aux VLANs
* Avantages :

  * Gain de bande passante avec EtherChannel
  * Optimisation de la navigation et de la connectivité IP
  * Pas besoin de liaisons externes supplémentaires pour le routage

---

## **III) Configuration du routage inter-VLANs avec 802.1Q (Router on a stick)**

### **Exemple topologie**

* VLAN 20 → réseau 192.168.20.0/24
* VLAN 30 → réseau 192.168.30.0/24
* VLAN natif → VLAN 99

### **Étapes de configuration**

1. **Activer l’interface physique du routeur**

```
Router> enable
Router# config terminal
Router(config)# interface fa0/0
Router(config-if)# no shutdown
Router(config-if)# exit
```

2. **Créer les sous-interfaces pour chaque VLAN**

```
Router(config)# interface fa0/0.1
Router(config-subif)# encapsulation dot1Q 20
Router(config-subif)# ip address 192.168.20.254 255.255.255.0
Router(config-subif)# no shutdown
Router(config-subif)# exit

Router(config)# interface fa0/0.2
Router(config-subif)# encapsulation dot1Q 30
Router(config-subif)# ip address 192.168.30.254 255.255.255.0
Router(config-subif)# no shutdown
Router(config-subif)# exit
```

3. **Configurer le port trunk sur le switch**

```
Switch(config)# interface fa0/24
Switch(config-if)# switchport mode trunk
Switch(config-if)# switchport trunk allowed vlan 20,30,99
Switch(config-if)# switchport trunk native vlan 99
Switch(config-if)# no shutdown
Switch(config-if)# exit
```

4. **Tester la connectivité inter-VLANs** avec un ping depuis un PC d’un VLAN vers un PC d’un autre VLAN.

---

## **IV) Router on a stick (définition)**

* Utilise **une seule interface physique** pour router plusieurs VLANs via des sous-interfaces.
* Avantages :

  * Simple à configurer
  * Économique en ports
  * Idéal pour petits/moyens réseaux
* Configuration : chaque sous-interface = passerelle par défaut pour un VLAN spécifique.

---

## **V) Routage inter-VLANs traditionnel**

* Chaque VLAN nécessite **une interface physique distincte** sur le routeur.
* Problèmes :

  * Besoin de beaucoup de ports physiques → peu évolutif
  * Plus coûteux pour réseaux étendus
* Avantages : peut être simple pour un petit nombre de VLANs et topologies fixes.

---

## **VI) Points clés**

* **Routage inter-VLANs** = communication entre VLANs → nécessaire pour partager services tout en gardant isolation.
* **Méthodes** :

  * Router on a stick (sous-interfaces, 1 port)
  * SVI (routage Layer 3 sur switch)
  * Routage traditionnel (interfaces séparées)
* **802.1Q** → encapsulation VLAN sur les trames pour router correctement entre VLANs.
* **Port trunk sur switch** indispensable pour transporter plusieurs VLANs vers le routeur ou switch Layer 3.

---