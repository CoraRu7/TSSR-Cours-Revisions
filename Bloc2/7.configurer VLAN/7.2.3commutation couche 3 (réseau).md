# **Commutation de couche 3 (Switch Layer 3)**

## **I) Introduction**

### **Contexte**

* Les **commutateurs** connectent plusieurs dispositifs dans un réseau local.
* Fonctionnent **principalement sur la couche 2 (liaison)** : dirigent le trafic en utilisant les **adresses MAC**.
* Avec les **VLANs**, les commutateurs séparent logiquement un réseau physique en plusieurs réseaux logiques.

### **Communication entre appareils**

* Chaque appareil a :

  * **Adresse IP** → couche 3
  * **Adresse MAC** → couche 2
* Sans switch intelligent, communication entre VLANs distincts = via un **routeur dédié**.
* Avec VLANs sur switch Layer 2 : les périphériques de VLANs différents nécessitent toujours un **routage Layer 3**.

---

## **II) Commutateur de couche 3**

### **Définition**

* Fonctionne à la fois sur la **couche 2 et la couche 3**.
* Permet aux dispositifs de VLANs différents de **communiquer directement** sans passer par un routeur dédié.
* **Routage Layer 3 activé uniquement si configuré** ; un switch L3 peut fonctionner en mode Layer 2 uniquement.

### **Fonctionnement**

1. Paquet reçu → inspecte l’en-tête.
2. Si destiné à un autre VLAN → traitement au **niveau Layer 3**.
3. Décision de routage → consultation table MAC → envoi par le port approprié.

### **Quand utiliser un switch L3**

* Plus d’un VLAN devant communiquer.
* Réseau moyen à large (> dizaines d’utilisateurs).
* Politiques de sécurité nécessitant **contrôle d’accès** entre VLANs.
* Simplification de gestion réseau (moins d’appareils à maintenir).

### **Avantages**

* Réduit le nombre de routeurs dédiés.
* Optimise la gestion du réseau et les mises à jour.

### **Inconvénients**

* Coût supérieur pour petits réseaux.
* Complexité inutile si réseau petit et simple.

---

## **III) Routage inter-VLANs sur switch L3**

### **Définition SVI (Switch Virtual Interface)**

* Interface **logique** sur switch multicouche.
* Fournit le **routage Layer 3** pour les ports associés à un VLAN.
* **SVI Layer 3** : gestion + routage
* **SVI Layer 2** : gestion uniquement (VLAN, telnet/SSH)

### **Processus**

1. SVI agit comme **passerelle par défaut** pour le VLAN.
2. Paquet vers un autre VLAN → livré au switch L3 → routé vers VLAN de destination.
3. Les **ACL, DHCP, OSPF** s’appliquent sur les interfaces VLAN logiques.

---

## **IV) Configuration d’un switch L3 avec SVI**

### **Topologie**

* VLAN 10 → PC1, PC2
* VLAN 20 → PC3, PC4

### **Étapes**

1. **Activer le routage** sur le switch

```
Switch(config)# ip routing
Switch# show ip route
```

2. **Attribuer les VLANs aux ports**

```
Switch(config)# vlan 2
Switch(config)# vlan 3
Switch(config)# int range fa0/1-2
Switch(config-if-range)# switchport access vlan 2
Switch(config)# int range fa0/3-4
Switch(config-if-range)# switchport access vlan 3
```

3. **Créer les SVI et attribuer des IP**

```
Switch(config)# int vlan 2
Switch(config-if)# ip address 192.168.1.1 255.255.255.0
Switch(config)# int vlan 3
Switch(config-if)# ip address 192.168.2.1 255.255.255.0
```

4. **Tester la connectivité**

```
PC1 > ping 192.168.2.20 (PC4)
```

* Le paquet passe par le switch L3 → SVI → VLAN destination.

---

## **V) Résumé comparatif : switch L2 vs L3**

| Fonction                      | Switch L2 | Switch L3       |
| ----------------------------- | --------- | --------------- |
| Table MAC                     | Oui       | Oui             |
| Routage IP                    | Non       | Oui (si activé) |
| Routage inter-VLAN            | Non       | Oui             |
| Gestion VLAN                  | Oui       | Oui             |
| Routage dynamique (OSPF, RIP) | Non       | Oui             |

**Point clé** : un switch L3 peut **effectuer routage inter-VLANs**, mais doit être configuré (activation du routage + SVI).

---